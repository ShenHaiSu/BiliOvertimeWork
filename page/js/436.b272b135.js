"use strict";(self["webpackChunkbili_overtime_work_frontend"]=self["webpackChunkbili_overtime_work_frontend"]||[]).push([[436,745],{9745:function(t,e,o){o.r(e),o.d(e,{default:function(){return m}});var a=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"OBSOvertimeWork"}},[e("div",{attrs:{id:"timeLeftShow"}},[e("h5",[t._v("加班时间")]),e("b",[t._v(t._s(t.timeFormat(t.currentWorkTime)))])]),e("div",{attrs:{id:"modItemList"}},[e("h5",[t._v("礼物列表")]),e("b-row",[t._l(t.modList,(function(o,a){return[e("b-col",{key:a+"key",staticClass:"",attrs:{cols:"4"}},[e("b-container",{staticClass:"modListDataShow",staticStyle:{position:"relative",padding:"0"}},[o.img?e("b-img-lazy",{staticClass:"modListDataImg",attrs:{src:o.img}}):e("span",[t._v(t._s(o.giftName))]),e("span",{staticClass:"modListItemCount"},[t._v(t._s(1!==o.count?"x"+o.count:""))])],1),e("p",{staticClass:"modListDataDesc"},[t._v(t._s(t.modTypeFormat(o)))])],1)]})),0===t.modList.length?[e("b-container",[e("br"),e("p",{staticStyle:{color:"white","font-size":"30px"}},[t._v("当前礼物列表为空")])])]:t._e()],2)],1)])},r=[],s=o(7008),i={name:"ViewOvertimeWork",data(){return{currentWorkTime:0,modList:[],tempGiftList:[]}},methods:{timeFormat(t){return s.Z.timeFormat(t)},modTypeFormat(t){let e="";switch(t.type){case"add":e=`+${this.timeFormat(t.timeChange)}`;break;case"reduce":e=`-${this.timeFormat(t.timeChange)}`;break;case"multi":e=`×${t.timeChange}`;break;case"division":e=`÷${t.timeChange}`;break;case"power":e=`${t.timeChange}次方`;break;case"clear":e="重置";break}return e},freshBackImage(){let t=document.getElementById("timeLeftShow"),e=document.getElementById("modItemList");t.style.backgroundImage="",e.style.backgroundImage="",t.style.backgroundImage=`url("http://${location.host}/API/overtimeWork/assets/background-top.png?${s.Z.getRandomString()}")`,e.style.backgroundImage=`url("http://${location.host}/API/overtimeWork/assets/background-bottom.png?${s.Z.getRandomString()}")`},async getBaseInfo(){let t=await s.Z.sendRequest.call(this,"/API/overtimeWork/getInfo");t.err||(this.currentWorkTime=t.data.currentWorkTime,this.modList=t.data.modList,this.tempGiftList=t.data.tempGiftList,this.$forceUpdate())}},mounted(){this.getBaseInfo(),this.$EventBus.$on("OvertimeWork-changeTime",(t=>{t=JSON.parse(t),this.currentWorkTime=t["timeLeft"]})),this.$EventBus.$on("OvertimeWork-changeModList",(t=>{t=JSON.parse(t),this.modList=t["data"]})),this.$EventBus.$on("OvertimeWork-freshPage",(()=>{this.$forceUpdate(),this.freshBackImage()})),setInterval((()=>{this.currentWorkTime<=0||!this.$store.state.liveStatus||this.currentWorkTime--}),1e3),this.freshBackImage()},computed:{}},n=i,c=o(1001),l=(0,c.Z)(n,a,r,!1,null,"1bcef209",null),m=l.exports},3436:function(t,e,o){o.r(e),o.d(e,{default:function(){return p}});var a=function(){var t=this,e=t._self._c;return e("b-container",{attrs:{fluid:"",id:"OutContainer"}},[e("hr"),e("h1",[e("b",[t._v("加班组件")]),e("b-badge",{staticStyle:{"font-size":"14px"}},[t._v("v1.3 配置面板")])],1),e("hr"),e("b-container",{attrs:{fluid:""}},[e("b-row",[e("b-col",[e("b-btn",{on:{click:t.getBaseInfo}},[t._v("刷新面板信息")])],1),e("b-col",[e("b-btn",{attrs:{variant:"primary"},on:{click:t.openOBSView}},[t._v("打开OBS显示窗口")])],1),e("b-col",[e("b-btn",{attrs:{variant:"primary"},on:{click:t.copyOBSViewAddress}},[t._v("复制OBS显示窗口网址")])],1),e("b-col",[e("b-btn",{attrs:{variant:"danger"},on:{click:t.resetTimeLeft}},[t._v("重置剩余加班时间")])],1)],1),e("hr"),e("b-row",[e("b-col",{staticStyle:{"min-width":"350px","max-width":"400px"},attrs:{cols:"4"}},[e("OBSView")],1),e("b-col",[e("b-row",[e("b-col",{attrs:{cols:"6"}},[e("h3",[t._v("基础信息")]),e("br"),e("b-row",[e("b-col",{attrs:{cols:"3"}},[e("span",{staticClass:"baseText"},[t._v("默认时间")])]),e("b-col",[e("b",{staticClass:"baseText"},[t._v(t._s(t.timeFormat(this.defaultWorkTime)))])])],1),e("b-row",[e("b-col",{attrs:{cols:"3"}},[e("span",{staticClass:"baseText"},[t._v("剩余时间")])]),e("b-col",[e("b",{staticClass:"baseText"},[t._v(t._s(t.timeFormat(this.currentWorkTime)))])])],1)],1),e("b-col",{attrs:{cols:"6"}},[e("h3",[t._v("快捷操作")]),e("br"),e("b-input",{attrs:{placeholder:t.fastModDesc,type:"number"},model:{value:t.fastModCount,callback:function(e){t.fastModCount=t._n(e)},expression:"fastModCount"}}),e("br"),e("b-btn",{attrs:{variant:"primary"},on:{click:t.fastModTime}},[t._v("提交更改")])],1)],1),e("br"),e("br"),e("hr"),e("h3",[t._v("礼物修改时间列表")]),e("br"),e("b-row",[e("b-col",{directives:[{name:"b-popover",rawName:"v-b-popover.hover.bottom",value:"如果有两笔数据的礼物名相同，那么序号小的触发，序号大的将不会触发。",expression:"'如果有两笔数据的礼物名相同，那么序号小的触发，序号大的将不会触发。'",modifiers:{hover:!0,bottom:!0}}],attrs:{cols:"1",title:"配置的序号"}},[t._v("序号 ")]),e("b-col",{directives:[{name:"b-popover",rawName:"v-b-popover.hover.bottom",value:"只允许填入字符串。需要和真实礼物名完全一一对应。",expression:"'只允许填入字符串。需要和真实礼物名完全一一对应。'",modifiers:{hover:!0,bottom:!0}}],attrs:{cols:"2",title:"触发的礼物名"}},[t._v("礼物名 ")]),e("b-col",{directives:[{name:"b-popover",rawName:"v-b-popover.hover.bottom",value:"允许的类型分别是增加、减少、乘以、除以、N次方、重置。",expression:"'允许的类型分别是增加、减少、乘以、除以、N次方、重置。'",modifiers:{hover:!0,bottom:!0}}],attrs:{cols:"2",title:"触发事件的类型"}},[t._v("类型 ")]),e("b-col",{directives:[{name:"b-popover",rawName:"v-b-popover.hover.bottom",value:"指时间变动触发事件所需要的礼物数量，如果低于这个数量，仅会将数据累加，直到超过阈值。",expression:"'指时间变动触发事件所需要的礼物数量，如果低于这个数量，仅会将数据累加，直到超过阈值。'",modifiers:{hover:!0,bottom:!0}}],attrs:{cols:"2",title:"触发事件的阈值"}},[t._v("阈值 ")]),e("b-col",{directives:[{name:"b-popover",rawName:"v-b-popover.hover.bottom",value:"必须填入大于0的整数。如果触发类型是N次方，那么次数变化量代表次方数。例如2代表平方。如果类型是重置，那么变化量无法设置。",expression:"'必须填入大于0的整数。如果触发类型是N次方，那么次数变化量代表次方数。例如2代表平方。如果类型是重置，那么变化量无法设置。'",modifiers:{hover:!0,bottom:!0}}],attrs:{cols:"3",title:"触发事件后加班时间的变化量"}},[t._v("变化量 ")]),e("b-col",{directives:[{name:"b-popover",rawName:"v-b-popover.hover.bottom",value:"点击按钮对指定行的数据进行操作，如果需要重置可以点击界面上方的 刷新面板信息 ",expression:"'点击按钮对指定行的数据进行操作，如果需要重置可以点击界面上方的 刷新面板信息 '",modifiers:{hover:!0,bottom:!0}}],attrs:{cols:"2",title:"对单笔数据进行操作"}},[t._v("操作 ")])],1),e("br"),0===t.modList.length?[e("b-badge",[t._v("列表为空")]),e("br")]:t._e(),t._l(t.modList,(function(o,a){return[e("b-row",{key:a+"no",staticClass:"DataRow"},[e("b-col",{attrs:{cols:"1"}},[t._v(t._s(a+1))]),e("b-col",{attrs:{cols:"2"}},[e("b-input",{model:{value:o.giftName,callback:function(e){t.$set(o,"giftName",e)},expression:"item.giftName"}})],1),e("b-col",{attrs:{cols:"2"}},[e("b-select",{attrs:{options:t.modOptionsList},on:{change:function(e){return t.modTypeChange(o)}},model:{value:o.type,callback:function(e){t.$set(o,"type",e)},expression:"item.type"}})],1),e("b-col",{attrs:{cols:"2"}},[e("b-input",{attrs:{type:"number"},model:{value:o.count,callback:function(e){t.$set(o,"count",t._n(e))},expression:"item.count"}})],1),e("b-col",{attrs:{cols:"3"}},[e("b-input",{attrs:{disabled:"clear"===o.type,type:"number"},model:{value:o.timeChange,callback:function(e){t.$set(o,"timeChange",t._n(e))},expression:"item.timeChange"}})],1),e("b-col",{attrs:{cols:"2"}},[e("b-btn",{attrs:{variant:"danger"},on:{click:function(e){return t.deleteItem(a)}}},[t._v("删除")])],1)],1)]})),e("br"),e("b-row",[e("b-col",[e("b-btn",{staticStyle:{width:"50%"},on:{click:t.addNewModItem}},[t._v("新增一笔数据")])],1),e("b-col",[e("b-btn",{staticStyle:{width:"50%"},attrs:{variant:"primary"},on:{click:t.uploadModList}},[t._v("上传列表")])],1),e("b-col",[e("b-btn",{staticStyle:{width:"50%"},attrs:{variant:"danger"},on:{click:t.getBaseInfo}},[t._v("重置列表")])],1)],1),e("br"),e("br"),e("hr"),e("h3",[t._v("窗口背景")]),e("br"),e("b-row",[e("b-col",{attrs:{cols:"2"}},[t._v("头部背景")]),e("b-col",{attrs:{cols:"7"}},[e("b-form-file",{attrs:{id:"topImageFile",accept:"image/*",placeholder:"选择一个背景文件"}})],1),e("b-col",{attrs:{cols:"3"}},[e("b-btn",{attrs:{variant:"primary"},on:{click:function(e){return t.uploadImage("topImageFile")}}},[t._v("上传")]),t._v("   "),e("b-btn",{attrs:{variant:"danger"},on:{click:function(e){return t.clearImage("top")}}},[t._v("清除")])],1)],1),e("br"),e("b-row",[e("b-col",{attrs:{cols:"2"}},[t._v("礼物列表背景")]),e("b-col",{attrs:{cols:"7"}},[e("b-form-file",{attrs:{id:"bottomImageFile",accept:"image/*",placeholder:"选择一个背景文件"}})],1),e("b-col",{attrs:{cols:"3"}},[e("b-btn",{attrs:{variant:"primary"},on:{click:function(e){return t.uploadImage("bottomImageFile")}}},[t._v("上传")]),t._v("   "),e("b-btn",{attrs:{variant:"danger"},on:{click:function(e){return t.clearImage("bottom")}}},[t._v("清除")])],1)],1)],2)],1)],1),e("br"),e("br"),e("br"),e("br"),e("br")],1)},r=[],s=o(9669),i=o.n(s),n=o(289),c=o(8175),l=o.n(c),m=o(7008),d=o(9745),u={name:"OvertimeWorkConfig",data(){return{defaultWorkTime:0,currentWorkTime:0,modList:[],tempGiftList:[],fastModCount:null,modOptionsList:[{value:"add",text:"增加"},{value:"reduce",text:"减少"},{value:"multi",text:"乘以"},{value:"division",text:"除以"},{value:"power",text:"N次方"},{value:"clear",text:"重置"}],OBSViewAddress:"/OBSView/overtimeWork",fastModDesc:"填入修改量，正数增加，负数减少。(单位：秒)"}},methods:{async resetTimeLeft(){if(!window.confirm("确定要将当前剩余加班时间删除，并设置为默认加班时间吗？"))return;let t=await this.sendRequest("/API/overtimeWork/resetTime","post");t.err||(n.C.call(this,"重置时间成功","已经将剩余加班时间重置为默认时间。","success"),this.getBaseInfo().then())},async getBaseInfo(){let t=await this.sendRequest("/API/overtimeWork/getInfo","get");t.err||(this.defaultWorkTime=t.data.defaultWorkTime,this.currentWorkTime=t.data.currentWorkTime,this.modList=t.data.modList,this.tempGiftList=t.data.tempGiftList,this.$forceUpdate())},async fastModTime(){if(!this.fastModCount)return n.C.call(this,"参数不符合要求","快捷操作量必须是正负整数。","danger");let t=await this.sendRequest("/API/overtimeWork/fastMod","post",{modCount:parseInt(this.fastModCount)});t.err||(n.C.call(this,"快捷操作修改完毕。","操作修改完毕，如果剩余加班时间没有变动，请尝试点击刷新信息按钮。","success"),this.getBaseInfo().then())},async uploadModList(){if(!window.confirm("请确认数据是否合规，上传后核心将会自动删除不合规的数据。并不保留不合规数据。"))return;let t=await this.sendRequest("/API/overtimeWork/updateModList","post",this.modList);t.err||n.C.call(this,"上传数据已完成","如果列表没有刷新，可以点击 '重置列表' 获取当前最新可用的列表","success")},async clearImage(t){let e=await m.Z.sendRequest.call(this,"/API/overtimeWork/clearBackImage","post",{target:t});e.err||n.C.call(this,"已删除背景图片","可能刷新即可查看效果","success")},uploadImage(t){let e=document.getElementById("topImageFile"===t?"topImageFile":"bottomImageFile").files[0];if(!e)return n.C.call(this,"参数缺失","请先选择一个图片作为背景再上传","warning");let o=new FormData,a="topImageFile"===t?"background-top.png":"background-bottom.png";o.append("file",e),o.append("fileName",a),i()({url:"/API/overtimeWork/updateBackImage",method:"post",data:o}).then((t=>{n.C.call(this,"上传完成",t.data.message,"success"),this.$forceUpdate()})).catch((t=>{n.C.call(this,"上传失败",t.message,"danger")}))},openOBSView(){open(m.Z.getLocalCustomAddress(this.OBSViewAddress))},copyOBSViewAddress(){let t=m.Z.getLocalCustomAddress(this.OBSViewAddress);l().copy(t),n.C.call(this,"内容已复制",t,"success")},deleteItem(t){this.modList.splice(t,1)},timeFormat(t){return m.Z.timeFormat(t)},addNewModItem(){this.modList.push({giftName:"空白",count:0,timeChange:0,type:"add"})},modTypeChange(t){"clear"===t.type&&(t.timeChange=1)},sendRequest(t,e="get",o={}){return i()({url:t,method:e,data:o}).then((t=>({err:!1,data:t.data}))).catch((t=>(n.C.call(this,"请求失败",t.message,"danger"),{err:!0})))}},mounted(){this.getBaseInfo(),setInterval((()=>{this.currentWorkTime<=0||!this.$store.state.liveStatus||this.currentWorkTime--}),1e3),this.$EventBus.$on("OvertimeWork-changeTime",(t=>{t=JSON.parse(t),this.currentWorkTime=t["timeLeft"]})),this.$EventBus.$on("OvertimeWork-changeModList",(t=>{t=JSON.parse(t),this.modList=t["data"]})),this.$EventBus.$on("OvertimeWork-freshPage",(()=>this.$forceUpdate()))},components:{OBSView:d["default"]}},b=u,h=o(1001),v=(0,h.Z)(b,a,r,!1,null,"5a5a87f2",null),p=v.exports},7008:function(t,e,o){var a=o(9669),r=o.n(a),s=o(289);const i="qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM0123456789";function n(t,e="get",o){return r()({url:t,method:e,data:o}).then((t=>({err:!1,data:t.data}))).catch((t=>(s.C.call(this,"请求出现错误",t.message,"danger"),{err:!0})))}function c(t=0){let e="";return t>=31536e3&&(e+=Math.floor(t/31536e3)+"年 ",t-=31536e3*Math.floor(t/31536e3)),t>=86400&&(e+=Math.floor(t/86400)+"天 ",t-=86400*Math.floor(t/86400)),t>=3600&&(e+=Math.floor(t/3600)+"小时 ",t-=3600*Math.floor(t/3600)),t>=60&&(e+=Math.floor(t/60)+"分钟 ",t-=60*Math.floor(t/60)),e+=Math.floor(t)+"秒",e}function l(t="/"){return`http://${location.host}/#${"/"===t.slice(0,1)?"":"/"}${t}`}function m(t=10){let e="";for(let o=0;o<t;o++)e+=i[Math.floor(Math.random()*i.length+1)];return e}e["Z"]={sendRequest:n,timeFormat:c,getLocalCustomAddress:l,getRandomString:m}}}]);
//# sourceMappingURL=436.b272b135.js.map